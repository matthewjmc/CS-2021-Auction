package AuctionSystem

import (
	. "CS-2021-Auction/AuctionSystem"
	"database/sql"
	"fmt"
	"sync"
	"time"

	_ "github.com/go-sql-driver/mysql"
)

func databaseInit() {

	db, err := sql.Open("mysql", "auction:Helloworld1@tcp(db.mcmullin.org)/")
	if err != nil {
		fmt.Println(err.Error())
	} else {
		fmt.Println("Database created successfully")
	}
	_, err = db.Exec("CREATE DATABASE auction_system")
	if err != nil {
		fmt.Println(err.Error())
	} else {
		fmt.Println("Successfully created database..")
	}
	_, err = db.Exec("USE auction_system")
	if err != nil {
		fmt.Println(err.Error())
	} else {
		fmt.Println("DB selected successfully..")
	}

	stmt, err := db.Prepare("CREATE Table user_table( AccountID int UNSIGNED NOT NULL UNIQUE PRIMARY KEY, first_name varchar(20) NOT NULL, last_name varchar(20) NOT NULL )")
	if err != nil {
		fmt.Println(err.Error())
	}
	_, err = stmt.Exec()
	if err != nil {
		fmt.Println(err.Error())
	} else {
		fmt.Println("User Table created successfully..")
	}

	stmt2, err := db.Prepare("CREATE Table bid_table( biddingID int UNSIGNED NOT NULL UNIQUE PRIMARY KEY, bidderID int UNSIGNED NOT NULL UNIQUE, bidderUsername varchar(30) NOT NULL, bidPrice int UNSIGNED NOT NULL, bidTime varchar(30) NOT NULL,FOREIGN KEY (bidderID) REFERENCES user_table(AccountID) );")
	if err != nil {
		fmt.Println(err.Error())
	}
	_, err = stmt2.Exec()
	if err != nil {
		fmt.Println(err.Error())
	} else {
		fmt.Println("Bid Table created successfully..")
	}

	stmt3, err := db.Prepare("CREATE Table auction_table( AuctionID int UNSIGNED NOT NULL UNIQUE PRIMARY KEY,AuctioneerID int UNSIGNED NOT NULL,ItemName varchar(30) NOT NULL, CurrWinnerID int UNSIGNED NOT NULL, CurrWinnerName varchar(30), CurrMaxBid int UNSIGNED NOT NULL, BidStep int UNSIGNED NOT NULL, LatestBidTime varchar(30) NOT NULL, StartTime varchar(30) NOT NULL, EndTime varchar(30) NOT NULL, FOREIGN KEY (AuctioneerID) references user_table(AccountID), FOREIGN KEY (CurrWinnerID) references user_table(AccountID))")
	if err != nil {
		fmt.Println(err.Error())
	}
	_, err = stmt3.Exec()
	if err != nil {
		fmt.Println(err.Error())
	} else {
		fmt.Println("Auction Table created successfully..")
	}

	defer db.Close()
}

// Server : db.mcmullin.org:3306
// username : auction
// password : Helloworld1
